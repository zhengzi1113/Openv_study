# 特征点检测和匹配
## 特征检测的基本概念

    特征检测是计算机视觉和图像处理中的一个概念。它指的是使用计算机提取图像信息，决定每个图像的点是否属于个图像特征。特征检测的结里是把图像上的点分为不同的子集，这些子集往往属于孤立的点、连续的曲线或者连续的区域。

    特征检测包括边缘检测，角检测，区域检测和脊检测.

    特征检测应用场景:
        图像搜索
        拼图游戏
        图像拼接
        ...

以拼图游戏为例来说明特征检测的应用流程
1. 寻找特征
2. 特征是唯一的
3. 特征是可追踪的
4. 特征是能比较的

![这是图片](./img/拼图1.jpg "Magic Gardens")

我们发现:
    平坦部分很难找到它在原图中的位置
    边缘相比平坦要好找一些,但是也不能一下确定
    角点可以一下就找到其在原图中的位置

图像特征就是值有意义的图像区域，具有独特性,易于识别性,比较角点，斑点以及高密度区。
在图像特征中最重要的就是角点， 哪些是角点呢?

    灰度梯度的最大值对应的像素
    两条线的交点
    极值点 (一阶导数最大，二阶导数为0)

# Harris角点检测
![这是图片](./img/Harris.jpg "Magic Gardens")

## harris角点检测原理
![这是图片](./img/Harris原理.jpg "Magic Gardens")
![这是图片](./img/Harris原理1.jpg "Magic Gardens")
![这是图片](./img/Harris原理2.jpg "Magic Gardens")
![这是图片](./img/Harris原理3.jpg "Magic Gardens")
![这是图片](./img/Harris原理4.jpg "Magic Gardens")

    检测窗口在图像上移动，上图对应着三种情况
        在平坦区域无论向哪个方向移动,衡量系统变换不大
        边缘区域，垂直边缘移动是,衡量系统变换剧烈.
        在角点处，往哪个方向移动，衡量系统都变化剧烈
        cornerHarris(src, blockSize, ksize, k[, dst[, borderType]])
            blockSize : 检测窗口大小
            ksize : sobel的卷积核
            k: 权重系数即上面公式中的 a，是个经验值一般取0.04~0.06之间.一般默认0.04

### Shi-Tomasi角点检测
    Shi-Tomasi是Harris角点检测的改进
    
    Harris角点检测计算的稳定性和K有关，而K是一个经验值不太好设定最佳的K值
    
    Shi-Tomasi发现，角点的稳定性其实和矩阵 M 的较小特征值有关，于是直接用较小的那个特征值作为分数。这样就不用调整k值了。

        shi-Tomasi将分数公式改为如下形式:R=min(2)
        和 Harris 一样，如果该分数大于设定的闯值，我们就认为它是一个角点。
        
    goodFeaturesToTrack(image, maxCorners, qualityLevel, minDistance[, corners[, mask[, blockSize[, useHarrisDetector[, k]]]]])

        maxCorners : 角点的最大数值为0表示无限制

        qualityLevel : 角点质量,小于1.0的整数一般在0.01-0.1之间

        minDistance : 角之间最小欧式距离忽略小于此距离的点

        mask : 感兴趣的区域

        blockSize : 检测窗口大小

        useHarrisDetector : 是否使用Harris算法
        
        k : 默认是0.04

## SIFT关键点检测
    SIFT，即度不变特征变换 (Scale-invariant feature transform，SIFT)，是用于图像处理领域的一种描述。这种描述具有尺度不变性，可在图像中检测出关键点，是一种局部特征描述。

    Harris角点具有旋转不变的特性.但是缩放后，原来的角点有可能就不是角点了


### SIFT原理（尺度不变特征转换）
    SIFT 特征点位置和尺度的提取
    SIFT算法从其命名就可以看出 其主要的贡献便是使得图像的特征具有尺度不变性，即相同的局部特征在不同size的图片下其特征的描述向量基本相同。

那么他的尺度不变性到底如何而来？

在 特征提取 步骤下，其主要应用了：

1. 图像金字塔 
    将图像经过一系列的降采样，不同大小的图片其空间形状像是金字塔，因此得名。

2. 图像尺度空间
    将图像经过不同尺度（σ）的高斯卷积算子，进而得到不同高斯尺度（σ）下的图像

![这是图片](./img/sift3.jpg "Magic Gardens")
![这是图片](./img/sift4.jpg "Magic Gardens")

特征点提取的具体步骤如下：

1. 将相同size的相邻高斯尺度之间的灰度图像进行减法运算，进而得到高斯差分图像。可以看得出其边缘特征比较明显。
2. 然后在高斯差分图像上检测特征点。
3. 假若一个像素点比其 周围8个点 + 相邻两个高斯差分图像上对应的18个点 的像素值（共26个）都大或都小，则该点为特征点。
4. 该特征点的尺度信息来自于 1. 检测出特征点所在的高斯差分图像，其图像的与原图的长宽比例 2. 检测出特征点所在的高斯差分图像的高斯尺度


#### 问题:

    为什么使用高斯差分图像？

        高斯差分图像近似与高斯拉普拉斯图像，但其计算复杂度却减少了很多，因此作者采用高斯差分去近似高斯拉普拉斯

    为什么像素点还要和相邻高斯差分图像上对应的点去比较像素值？

        因为 只有当高斯尺度（σ）与原图像中特征点的尺度相对应的时候，其相应达到极大值。因此当找到图像特征点处于极大值下的高斯尺度便可以得到图像特征点的尺度信息。